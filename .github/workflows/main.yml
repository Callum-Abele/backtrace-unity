# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the master branch
on:
  push:
    branches: [ feature/githubAction ]
env:
  UNITY_LICENSE: "<?xml version=\"1.0\" encoding=\"UTF-8\"?><root><License id=\"Terms\"><MachineBindings><Binding Key=\"1\" Value=\"00330-62837-12139-AAOEM\"/><Binding Key=\"2\" Value=\"00523_B8_1181B7_6C.9\"/><Binding Key=\"4\" Value=\"MDE3NTU0NjgxMDU3\"/><Binding Key=\"5\" Value=\"c6:9d:ed:9b:a2:5c\"/></MachineBindings><MachineID Value=\"W37dvWRidHt/NzfxC/tB5ifG5cA=\"/><SerialHash Value=\"9cbf62207e0a5454759588177622a17738dfd94b\"/><Features><Feature Value=\"33\"/><Feature Value=\"1\"/><Feature Value=\"12\"/><Feature Value=\"2\"/><Feature Value=\"24\"/><Feature Value=\"3\"/><Feature Value=\"36\"/><Feature Value=\"17\"/><Feature Value=\"19\"/><Feature Value=\"62\"/></Features><DeveloperData Value=\"AQAAAEY0LVU4QVctWDhGVC1VVUI0LVFaMzUtUUU4WA==\"/><SerialMasked Value=\"F4-U8AW-X8FT-UUB4-QZ35-XXXX\"/><StartDate Value=\"2018-02-06T00:00:00\"/><UpdateDate Value=\"2020-04-11T10:58:54\"/><InitialActivationDate Value=\"2018-02-06T12:22:13\"/><LicenseVersion Value=\"6.x\"/><ClientProvidedVersion Value=\"2017.2.0\"/><AlwaysOnline Value=\"false\"/><Entitlements><Entitlement Ns=\"unity_editor\" Tag=\"UnityPersonal\" Type=\"EDITOR\" ValidTo=\"9999-12-31T00:00:00\"/></Entitlements></License><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments\"/><SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/><Reference URI=\"#Terms\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/><DigestValue>oXMEIX2RFCa8YLMTDswhqT1CMD8=</DigestValue></Reference></SignedInfo><SignatureValue>yhtbLYzCrv6kKo96W+kivgRWsJlZ4GswE9uibnAm7DQdNG9atvxFJ3evEK8/68pdo1nGzmE1prE9e/XzlhQYZ30BvFLI5Sc0MgLJc8ps7TPi2+k0ATONSx3VtGNqKugi1Ir3Ho5olj7YlU5sFnmpHZ0US3fRoIljCnM/reE7kcyeR14Dk52YXXr0lZh+YqUirK3Eizrk110DU4T831rkmHaestlcmJTZl8Ktav21sOXG29uSvE45P/lN3JRegyI3Ptt255reF5kvi37X88TCGFzq1aR+b6dPwnRvoUKrUiN9+1Q37Sau457TdZUEl6ayQlMM9FlmRyHK2blwlAwP5g==</SignatureValue></Signature></root>"

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  buildAndTestForSomePlatforms:
    name: Build for ${{ matrix.targetPlatform }} on version ${{ matrix.unityVersion }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        projectPath:
          - ./
        unityVersion:
          - 2019.3.8f1
        targetPlatform:
          - StandaloneWindows64
          - Android
    steps:
      - uses: actions/checkout@v2
        with:
          lfs: true
      - uses: actions/cache@v1.1.0
        with:
          path: ${{ matrix.projectPath }}/Library
          key: Library-${{ matrix.projectPath }}-${{ matrix.targetPlatform }}
          restore-keys: |
            Library-${{ matrix.projectPath }}-
            Library-
      - uses: webbertakken/unity-test-runner@v1.3
        id: testRunner
        with:
          projectPath: ${{ matrix.projectPath }}
          unityVersion: ${{ matrix.unityVersion }}
      - uses: actions/upload-artifact@v1
        with:
          name: Test results (all modes)
          path: ${{ steps.testRunner.outputs.artifactsPath }}
      - uses: webbertakken/unity-builder@v0.10
        with:
          projectPath: ${{ matrix.projectPath }}
          unityVersion: ${{ matrix.unityVersion }}
          targetPlatform: ${{ matrix.targetPlatform }}
          # customParameters: "-myParameter myValue -myBoolean -ThirdParameter andItsValue"
      - uses: actions/upload-artifact@v1
        with:
          name: Build
          path: build
